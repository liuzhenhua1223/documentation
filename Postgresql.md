# 第一章 数据库系统概述

- 数据库技术
  - 数据库管理技术是组织或企业管理各类信息资源，几乎所有的领域都在采用数据库进行信息资源的存储和处理，因此数据库建设规模，是国家重要的`标识`

## 数据库的基本概念

### 数据（Data）

- 数据有多种表现形式，可以包括数字、字母、文字、特殊字符组成的文本数据，也可以是 图像、动画、影响、声音等各种形式的数据经过数字化处理后存入计算机。
  - 例如（张三，男，26，北京，19128220296）表示客户张三的信息

## 数据库（Database，DB）

- 通常被称为存储数据库的仓库，这个仓库存储在计算机存储设备上，并且所存储的数据是按一定的格式进行存储的。严格意义上讲，数据库指长期存储在计算机中 有组织的、可共享的数据集合，具有较小的冗余度、较高的数据独立性、系统易于扩展，并且可以被多个用户共享。
- `数据库中存储的数据具有永久存储、有组织和可共享三个基本特点`

## 数据库管理系统（DatabaseManagement System,DBMS)

- 是专门用于建立和管理数据库的一套软件，介于应用程序和操作系统之间。
- 科学有效的组织和存储数据，帮助数据库使用者从大量数据中快速地获取所需要的数据，以及提供必要的安全性和完整性，实现对数据有效的管理和维护。

1. 数据定义功能
   - 用户可以通过数据库管理系统提供数据定义语言（DDL）定义数据库中的数据对象，`包括表、视图、存储过程、触发器等`
2. 数据操纵功能
   - 用户可以通过数据库管理系统提供的数据操纵语言（DML）操作数据库中的数据，实现数据的`查询、插入、删除和修改等`
3. 数据库的运行管理功能
   - 数据库中可以提供多个用户同时使用共享数据，保证安全性、可靠性，并且开提供了控制和管理机制，从而数据不会被互相干扰的情况下并发使用，并且在故障是能够正确恢复
4. 数据库的建立和维护功能
   - 包括创建数据库及对数据库空间的维护、备份与恢复，重组织和性能监控、分析等。
5. 数据组织、存储和管理功能
   - 为提高数据存储效率，数据库管理系统需要对数据进行分类存储和管理。一般数据库管理系统会根据组织和存储方式提供多种存取方法、例如 索引查找，顺序查找等。

## 数据库系统（Database System，DBS）

- 是指在计算机中引入数据库技术之后的系统。通常一个完整的数据库系统包括数据库、数据库管理系统以及相关实用工具、应用程序、数据库管理员和用户
  - 其中DBA用来维护数据库正常运行，用户则是数据库系统的服务对象，其通常包括程序员和数据库终端用户，程序员通过高级设计语言(PHP JAVA)和数据库语言SQL，编写数据库应用程序。应用程序会根据需要想数据库管理系统发出合适的请求，再有数据库管理系统对数据库进行执行相应的操作，而终端用户则是从客户机或联机终端上交互方式向数据库系统提出请求，并由数据库管理系统响应执行，而后访问数据库中的数据
- 此外，一般在不引起混淆的情况下，常常将数据库管理系统简称为数据库。

# 第二章 数据管理技术的发展

## 数据库管理阶段分为

- 人工管理阶段

  - 20世纪50年代，主要通过手动的方式进行数据处理，一切靠人

    1. 数据不保存
       - 一组数据对应一个成勋，数据空间随着空间一切被释放

    2. 应用成勋管理数据
       - 当时没有数据库管理软件，数据库的设计工作，有应用程序的编写人员来完成。

    3. 数据面向应用
       - 一个数据只能对应一个程序，当多个应用程序 涉及某些数据时，必须各自定义，不能共享，因此程序与程序之间存在大量的冗余数据，数据的独立性差。

![image-20240530092527349](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240530092527349.png?raw=true)

## 文件系统管理阶段

- 文件系统是将 数据的`逻辑结构`和`物理结构`分离，由`存放方法`实现逻辑结构与物理结构之间的映射。`应用程序`只涉及数据`逻辑结构` `系统确定`数据的`物理结构`

- 这样当物理结构发生变化时，不会导致逻辑结构的修改，这成为数据的为例独立性

  ---

  可以理解为：逻辑结构就是数据(data)，物理结构(操作系统),当操作系统或者底层出现变化时，只要能提供操作系统或底层设备，就能正常运行逻辑结构数据

## 数据库系统管理阶段

### 数据集成

- 通过对数据的逻辑结构和物理结构的分离，当对应用进行增加等操作时，只对数据的逻辑结构发生关系。

- 这样可使数据得到最大程度的共享，且冗余最小

### 数据共享性高

- 数据共享指，在数据库中，一个数据库可以为多个不用的用户共同使用，各个用户可以为了不同的目的来存取 数据，并且他们是从不同的角度来看待数据库，即一个数据库有多个不同用户视图

### 数据冗余小

- 例如：学生学籍、学校图书馆应用、学校校园卡管理应用中，每一个应用都拥有一个包含学生信息的文件。而且对于数据库方法，这些独立而且有冗余的数据文件被集成为单一的逻辑结构，并且每一个数据项的值可以理想地只存储一次，从而节约存储空间，避免数据的重复存储。
- 但 并不是所有的冗余都应该被消除 ，有时，由于应用业务或技术上的原因，如果数据合法性校验、数据存取效率等方面，可以能就需要保持多个副本。因此，在数据库系统中，冗余是受控制的，保留必要的冗余也是系统预定的。

### 数据一致性

- 例如：一个学生的学号信息存储在数据库的两个记录中，当该学生应为调专业而需要更新他的学号时，若无控制，且只更新一个记录时，则会引起同一数据的两个副本的不一致性，此时数据库是不一致的。
- 显然引起不一致的根源是数据冗余。要是数据库只存储一次，则不会发生不一致行。但冗余又是避免不了的，所以，当发生更新时，数据库本身可以通过更新所有的其他副本来自动保持数据的一直性

### 数据独立性高

- **逻辑独立性**：
  - 想象你有一张表格，这张表格的数据可以通过不同的方式显示给不同的用户（或者应用程序）。
  - 比如，你有一张学生成绩表，老师看的是所有成绩，学生看到的只是自己的成绩，校长看到的是年级的平均成绩。
  - 如果某个应用程序（比如老师的应用程序）需要一些修改，比如增加一些功能，这时候只需要修改这个应用程序的视图，而不用去动表格本身。
  - 反过来，如果需要在表格里加一列数据，比如学生的手机号，只要不影响视图，应用程序也不需要修改。
  - 这种不互相干扰的特性，就是逻辑独立性。

### **物理独立性**：

- 想象你的数据存储在某个地方，可能是一台服务器，也可能是一个硬盘。
- 现在，如果你想换一种存储方式，比如从硬盘换到固态硬盘，或者换一个更快的数据库系统，只要这些改变不影响数据本身的定义（比如数据结构、数据内容），那么你就不用修改任何使用这些数据的应用程序。
- 应用程序继续照常运行，而不需要知道底层数据存储发生了什么变化。
- 这种随便换存储方式却不影响应用程序的特性，就是物理独立性。

---

现代的数据库系统中，通过数据独立性，你可以轻松应对这些变化而不需要频繁修改应用程序

---

### 实施统一管理与控制

- 主要包括数据的安全性、完整性、并发控制与故障恢复等，即数据库保护
- 数据安全性
  - 确保数据不被非法访问或破坏
  - 只有有权限的用户才能查看或修改特定数据
  - 比如，只有管理员才能看到用户的密码。
- 数据完整性
  - 确保数据正确、有效、符合规则
  - 数据必须在合理范围内，满足一定条件
  - 比如，性别字段只能是`男`或`女`
- 并发控制
  - 方式多个用户同时修改数据产生冲突
  - 确保同时操作数据不会导致错误
  - 比如，多个用户同时购买一张火车票，系统能正确处理。
- 故障恢复
  - 处理硬件故障，操作失误或人为损坏导致的数据损失
  - 能将数据库恢复到出错前的正确状态
  - 比如，断电后恢复到最近保存的数据状态

---

这样，数据库系统能统一管理和保护数据，确保数据安全、正确并在多用户环境中正常运行。

---

### 减少应用程序开发与维护的工作量

- 在数据库上开发与维护新的应用所花费的代价和时间大大减少。
- 数据库中，具有共享性和独立性，所以编程人员不需要承担基本数据文件设计。
- 应对数据变动，数据库中的类型、关系、存储方式变了，不需要大幅修改应用程序。传动文件系统中，数据变量就得重写程序，但数据库环境下，只需要小改动。

## 数据库系统结构

- 数据库管理员（DBA）的视角
  - 内部系统结构： 通常采用三级模式结构。
  - 外部体系结构： 表现为集中式结构，分布式结构和并行结构。
- 数据库应用用户的视角：
  - 运行与应用结构：通常具有客户/服务器（C/S）
  - 结构和浏览器/服务器（B/S)
- 三级模式结构
  - 内模式：也成为物理模式，描述数据的物理存储方法和数据结构。负责存储空间分配，数据压缩加密等。
  - 概念模式：描述整个数据库的逻辑结构和特性，是对所有用户可见的数据模式
  - 外模式：也成为用户视图，描述用户能看见和访问的数据。

![image-20240530125142922](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240530125142922.png?raw=true)

### 1. 模式（Schema）

- **模式是逻辑视图**：它不包括具体的技术细节，比如用什么数据库管理系统（DBMS），文件怎么组织，数据怎么存取，或者使用什么设备
- **数据库管理员（DBA）的任务**：DBA需要定义数据的逻辑结构、数据之间的关系，以及数据的安全性和完整性要求，而不是关心数据是如何存储的。
- **模式的中间层作用**：它在外模式（用户视图）和内模式（物理存储）之间起桥梁作用。模式不涉及数据的实际存储细节和硬件环境，也不依赖于具体的编程语言或开发工具。
- **唯一且稳定**：一个数据库只有一个模式，并且这个模式相对来说是稳定的。
- **模式描述语言（Schema DDL）**：数据库管理系统（DBMS）使用这种语言来定义模式，明确数据的逻辑结构、数据之间的关系，以及安全性和完整性等要求。

---

概念模式，就是

---



### 2.外模式

- **用户视图**：外模式是为了满足不同用户需求而提供的不同数据视图。它是整个数据库的一部分，供用户使用。
- **模式的子集**：外模式通常是整个数据库模式的一个子集，是对部分数据的重新组织。
- **因需而异**：不同用户可能有不同的需求、查看数据的方式、保密要求等，因此，每个用户的外模式可以不一样。
- **灵活多样**：同样的数据，在不同的外模式中，可以有不同的结构、类型、长度、保密级别等。这意味着数据库可以灵活地适应不同用户的需求。
  - 例如：在学校的管理信息系统中，教务处子系统用户只能看到教师的授课信息，学生的选课及成绩信息，人事处理系统用户只能看到教师的基本资料信息。

### 3.内模式（Internal Schema）

在三级模式结构中，内模式也称为存储模式（Storage Scheam），他是对数据库中数据物理结构和存储方式的描述，是数据库内部的表示形式。

- **存储描述**：内模式详细描述了数据在数据库内部的存储结构和方式。
- **底层视图**：这是数据库管理员看到的数据库内部结构。
- **独立于物理设备**：内模式与具体的物理存储设备无关，不涉及扇面、磁道等物理细节。
- **数据管理**：内模式定义了内部记录类型、索引、文件组织方式等数据管理细节，包括数据是按顺序还是按B树存储，是否压缩、加密等。
- **DBMS定义**：数据库管理系统使用内模式描述语言（DDL）来严格定义内模式。

## 三级模式结构的两层映像与数据独立性

### 外模式/模式映像

- 定义：
  - 外模式/模式映像是一种对应规则，用于定义外模式与概念模式之间的影响关系。他描述了如何将外模式转换为概念模式。由于一个概念模式可以有多个外模式，因此每个外模式都有其对应的外模式/模式映像。
- 功能与作用
  - 映像关系的定义：外模式/模式映像在各自的外模式中定义。这些映像关系确保外模式和概念模式之间的转换。
  - 应对模式变化：当概念模式发生变化（如增加新的关系、新的属性或改变属性的数据类型等）时，数据库管理员（DBA）会相应地调整各个外模式/映像模式。这使得用户的外模式不变。
  - 保持外模式稳定：通过调整映像关系，外模式不受概念模式i安华的影响，保证了应用程序的稳定性，编程人员无需修改基于外模式编写的应用程序。
  - 实现逻辑独立性：外模式的稳定性和独立性，确保了数据与程序的逻辑独立性，即使底层概念模式发生变化，也不会影响到外模式及其上层的应用。

---

外模式/模式映像在数据库系统中起到了桥梁作用，连接了外模式和概念模式。通过这一机制，数据库系统能够有效管理模式变化带来的影响，保证外模式的稳定，从而实现数据与程序的逻辑独立性，降低了应用程序维护的复杂度。

### 模式/内模式映像

- 定义了数据库全局逻辑结构与物理存储之间的对应关系，通常在模式中加以描述的。由于数据库只有一个模式，且只有一个内模式，所以`模式`/内模式映像是唯一的。
- 当数据库物理存储发生变化，DBA也会对`模式`/`内模式映像`做出相应的调整，以使数据库的模式保持不变，从而不去修改应用程序，如此实现了概念模型不受内模型变化的影响，并保证了数据与程序的物理独立性。
- 由此可见，这两层映像保证了数据库系统中的数据能具有较高的逻辑独立性和物理独立性，是的数据的定义和描述可以从应用程序分离，简化数据库应用开发，和维护的工作量

## 数据库系统体系结构

### C/S

![image-20240530163747496](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240530163747496.png?raw=true)

### B/S

![image-20240530164210879](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240530164210879.png?raw=true)

## 数据模型

- 是现实世界特征的模拟和抽象的表达，其有助于人们更好的认识客观世界中的事物、对象、过程等感兴趣的内容，例如：汽车模型、飞机模型、建筑图纸等等。对现实世界数据特征的抽象，描述的是数据的共性内容。

### 数据结构

- 描述静态特性，及数据类型、内容、属性及数据对象之间的联系。
- 常安数据结构的类型来命名：层次结构、网状结构、
- 关系结构的数据模型分别为命名：层次模型、网状模型、关系模型，以及近年来得到广泛应用的面向对象模型。

### 数据操作

- 数据操作主要分为更新和检索两大类，其中更新包括 插入、删除和修改。数据模型必须定义这些操作的确切含义，操作符号、操作规则(如优先级)以及实现操作的语言。

### 数据约束

- 数据约束描述数据结构中数据间语法和语义关联
- 数据约束包括：数据完整性约束、数据安全性约束、并发控制约束，通过约束刻画了数据静态特征，也表示了数据动态行为规则。
- 例如在关系模型中，任何关系必须满`足实体完整性`和`参照完整性`这两类约束。此外，数据模型还需要提供定义的完整性约束条件的机制，从而遵守特定的语义约束条件。
  - 例如：在某个网购数据库中，规定购买某些在线商品的客户的年龄不得低于18岁

### 数据模型分类

- 真实地模拟虚拟现实世界
- 容易被人们所理解
- 便于在计算机上实现

- 第一类是概念层数据模型，第二类是逻辑层数据模型和物理层数据模型。

![image-20240530174942827](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240530174942827.png?raw=true)

#### 概念层数据模型

- 概念层是数据抽象级别的最高层，其目的是按用户的观点来对世界建模。
- `概念层数据库模型`，也称数据的`概念模型`或`信息模型`用来描述世界的事物，与计算机系统无关，且独立与任何DBMS，但容易想DBMS所支持逻辑数据模型转换。

##### 信息世界中的基本概念

- 概念模型一方面具有较强的语义表达能力，能够方便、直接地表达应用的各种语义知识，另一方面他简单、清晰、易于用户理解。

1. 实体（Entity）
   - 实体可以是实际的事物，也可以是抽象的概念或联系。
     - 例如：商品、学生、部门、课程、比赛等都可以作为实体
2. 属性（Attribute）
   - 一个实体可以由多个属性来描述，
   - 例：学生、具有学号、姓名、性别、出生日期。
3. 码或键(Key)
   - 可以唯一标识实体的属性集为码或键
     - 例如，学号是学生实体的码或键
4. 域(Domain)
   - 属性的取值范围，称为该属性的域。
     - 例如：学生实体中姓名的域为字符串集合，性别的域为(男,女)
5. 实体型(Entity Type)
   - 具有相同属性的实体必然是有共同的特征和性质。
     - 例如：学生(学号、姓名、性别、出生日期)就是一个实体型
6. 实体集(Entity Set)
   - 同型实体的集合称为实体结合
     - 例如：每个学生是一个实体，所有学生构成一个实体集合
7. 联系（Relationship)
   - 在现实世界中，事物内部以及事物之间是有联系的，这些联系在信息世界中反映为实体(型)内部的联系和实体(型)之间的联系。实体内部的联系通常是指实体各属性之间的联系，例如，确定了学号，就一定能知道与之对应的姓名，即学号与姓名这两个属性之间有联系。实体之间的联系是指不同实体之间的联系，例如，一个班有许多的学生，一个学生只属于一个班级，学生与班级这两个实体之间有联系。型”(type)和“值”(value)两个不同的概念。
   - 需要注意的是，在数据模型中有“型”指的是对某一类数据的结构和属生的说明，而“值”是型的一个具体赋值。例如，在客户档案中，客户信息定义为(姓名，性别，年龄，籍贯，所在城市，联系电话)这样的记录型，而(张三，男，26,北，上海，13912345678)则是该记录型的一个记录值。

##### 概念模型的表示方法

- PPS.Chen 提出的实体-联系方法(Entity-Relationship approach)。该方法用E-R图来描述现实世界的概念模型，E-R方法也称为E-R模型

  - 实体型：其用矩形表示，矩形框内写明实体的名称。

  - 属性：其用椭圆形表示，并用无向边将其与相应的实体连接起来。

  - 联系：其用菱形表示，菱形框内写明联系的名称，并用无向边分别与有关实体连接起来。

    同时在无向边旁标上联系的类型，如果一个联系具有属性，则这些属性也要用无向边与该联系连接起来。

![image-20240530224858112](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240530224858112.png?raw=true)

**说明：**由于学生、课程等实体的属性较多，部分属性没有标出。另外，关于使用E-R图进行数据库概念结构 设计的细节。

**值得注意的是**：实体-联系方法是抽象和描述现实世界的有力工具。概念模型独立于具体的DBMS所支持的逻辑模型，他是各种逻辑模型的共同基础，因而比逻辑模型更一般，更抽象，更接近现实世界

### 逻辑层数据模型

- 这一层的数据抽象称为逻辑层 数据模型，也称为数据的逻辑模型(Logical Mode) 
- 他是用户通过数据库管理系统看到的现实世界，是基于计算机系统的观点对数据进行建模和表示，因此，既需要考虑用户理解，有要考虑便于DBMS实现。

#### 层次模型

1. **结构**：
   - 层次模型使用树形结构来表示数据，数据以父子关系层次化排列。
   - 每个节点表示一个数据项，每个节点可以有多个子节点，但每个子节点只能有一个父节点。
2. **优点**：
   - 数据结构简单，容易理解和实现。
   - 数据检索速度快，适合处理结构明确且关系单一的数据。
3. **缺点**：
   - 缺乏灵活性，不易适应复杂的多对多关系。
   - 由于父子关系的严格性，插入、删除和更新操作可能涉及大量的重新链接。
4. **使用场景**：
   - 适用于组织结构、目录结构等层次分明的应用场景。

#### 网状模型 

1. **结构**：
   - 网状模型使用图结构来表示数据，数据节点之间可以有多种关系。
   - 节点之间的连接通过边来表示，每个节点可以有多个父节点和多个子节点。
2. **优点**：
   - 更灵活，能够表示更复杂的多对多关系。
   - 通过索引机制，数据检索和操作可以更高效。
3. **缺点**：
   - 数据结构复杂，理解和实现较为困难。
   - 维护和管理较为复杂，可能需要更多的系统资源。
4. **使用场景**：
   - 适用于航班预定系统、电信网络等需要复杂数据关系的应用场景。

#### 关系模型

> 关系模型是用二维表结构来表示实体及实体间联系的模型，并以二维表格的形式组织数据库

- 关系模型是建立在严格的数学概念的基础上的。
- 关系模型的概念单一，统一用关系来表示实体以及实体之间的联系，对数据的检索和更新结构同样也是用关系(即表)来表示。因而，关系模型的数据结构简单、清晰，用户易懂，易用。
- 关系模型的存取路径对用户透明，从而具有更高的数据独立性、更好的安全保密性，也简化了工具和数据库建立的工作

# 第三章 关系数据库概述

### 数据库基本术语

- 关系数据结构
- 关系操作结合
- 关系完整约束

且关系数据库是以二维表格的形式组织数据如下图

![image-20240531145312594](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240531145312594.png?raw=true)

#### 表（Table）

表，也称为关系，是一个二维的数据结构，他由表名，构成的各个列(如 学号、姓名等)及若干行数据(各个学生的具体信息)组成。每个表有一个唯一的表名，表中每一行数据描述一条具体的记录值。

#### 关系(Relation)

一个关系逻辑上对应一张二维表，可以为每个关系取一个名称进行标识。例如，上面的图片，学生基本信息登记表，也即学生基本信息登记表。

- 基本关系
- 查询表
- 视图表

---

其中 基本关系通常又称为基本表或基表，真是存在的表，是实际存储数据的逻辑表示

查询表是查询结果对应的表

视图表是由基本表或其他视图表导出的表，是虚表，不应实际存储的数据

#### 列（Coloumn）

表中的列，也称为字段(Field)或属性(Attribute)。表中每一列有一个名称、字段名或属性名。每一列表示实体的一个属性，具有相同的数据类型。

![image-20240531164105916](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240531164105916.png?raw=true)

 需要说明的是：在一个数据库中，表名必须唯一，在表中，字段名必须唯一，不同表中可以出现相同的段名，表和字段的命名应尽量有意义，并尽量简单。

#### 属性（Attribute)

表中的一列即为一个属性，列的值称为属性值，属性值的取值范围称为值。录入上图表中：学号、姓名、性别等等即元数是8，即学生基本信息登记表关系是一个8元关系或8度关系。

#### 行（ROW）

也称作元组或记录。表中的数据是按行存储的。表中一行数据即为一个元组或十条记录。

#### 元组（Tuple）

表中的一行即为一个元组

![image-20240531165356058](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240531165356058.png?raw=true)

#### 分量(Component)

![image-20240531165824274](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240531165824274.png?raw=true)

**分量**是表格中的每一列，比如学号、姓名、班级等。

**码或键**是由一个或多个分量组成的，用来唯一标识表格中的每一行。

当码或键由多个分量组成时，这些分量的组合必须是唯一的

#### 码或键(Key)

码或键是一种方法，用来保证表格中的每一行都是独一无二的。

它可以是一个字段（比如学号），也可以是多个字段的组合（比如班级+座位号）。

#### 超码或超键(Super Key)

是一个或多个列（属性）的组合，这些列的组合能够唯一标识表格中的每一行。

超码可以包含多余的列，只要这组列能够保证唯一性。

- 学号 + 姓名
- 班级 + 座位号
  - 都是是唯一的

#### 候选码或候选键(Candidate Key)

> 是可以唯一标识表格中每一行的一组列，其中任意一个候选码都可以成为主键。
>
> 候选码是主键的候选项，而主键是最终选择的唯一标识符。

假设有一个学生信息表格，包含以下列：

- 学号（Student ID）
- 姓名（Name）
- 身份证号（ID Card Number）

在这个表格中，每个学生都有唯一的学号，所以学号可以作为候选码。同时，身份证号也可以作为候选码，因为每个学生的身份证号也是唯一的。

#### 主码或主键

> 一个关系的若干个候选码或候选键中指定一个用来唯一标识关系的元组，这个被指定的码或候选键为主键或主码

假设你有一个学生信息表，每行记录了一个学生的详细信息。在这个表里，学生的学号就是主键。因为每个学生的学号都是唯一的，所以你可以用学号来快速找到这个学生的所有信息。

#### 全码或全键(All-Key)

> 一个关系模式的所有属性集合是这个关系的主码或主键，则称这样的主码或主键为全码或全键

假设你有两个表：一个是“员工表”，里面有员工的ID（主键）和姓名；另一个是“部门表”，里面有部门的ID（主键）和部门名称。如果还有一个“员工部门表”，用来记录哪些员工属于哪个部门，那么这个表就会有两个外键：员工ID和部门ID，这两个外键分别与“员工表”和“部门表”的主键相匹配。

#### 主属性(PTimary Attribute)和非主属性

> 关系中包含任何一个候选码中的属性称为主属性或码属性，不包含任何一个候选码中的属性称为非主属性或非码属性。

**主属性**： 想象一下你有一个钱包，钱包里有很多卡，比如身份证、银行卡、会员卡等等。在这些卡中，身份证是最重要的，因为它能证明你的身份，没有它，很多事情都办不了。在数据库里，主属性就像身份证，是识别一条记录最核心的信息，比如一个人的姓名和身份证号，或者一个学生的学号。

**非主属性**： 还是拿钱包里的卡来比喻，除了身份证之外，其他的卡，比如银行卡、会员卡等，虽然也很重要，但它们不是证明你身份的核心。在数据库里，非主属性就像是这些其他的卡，它们提供了额外的信息，比如一个人的年龄、性别、住址等，但这些信息不是唯一识别一个人的最关键信息。

简单来说：

- **主属性**：是最重要的，用来唯一确定一条记录。
- **非主属性**：虽然也重要，但不是唯一确定记录的关键信息

#### 外码或外键(Foreign Key)

> 当关系中的某个属性不是这个关系的主码或候选码，而是另一个关系的主码时，称该属性为这个关系的外码或外键。

**外键**： 在数据库里，"外键"就像是购物中心里的门牌号。它是一个表里面的一个字段，用来指向另一个表的主键。就像门牌号帮助顾客找到商店一样，外键帮助数据库管理系统找到与之相关联的记录。

举个例子，假设你有一个"订单"表，每条记录代表一个顾客的订单。订单表里有一个字段叫做"顾客ID"，这个"顾客ID"就是外键，它指向"顾客"表里的"顾客ID"主键，这样你就知道每个订单是哪个顾客下的。

#### 15 参照关系和被参照表

Referencing Relation——Referenced Relation

1. **被参照表**：一个“学生”表，里面有一个“学号”字段作为主键，每个学生的学号都是唯一的。
2. **参照关系**：一个“课程”表，里面有一个“学生学号”字段作为外键，它参照“学生”表中的“学号”字段。

在这个例子中，每当你在“课程”表中添加一个新课程记录时，你必须确保“学生学号”字段中的学号在“学生”表中是存在的。这样，我们就知道这个课程记录是属于哪个学生的。

总结一下：

- **被参照表**：是包含主键的表，其他表通过外键与之建立关联。
- **参照关系**：是数据库表之间通过外键和主键建立的一种关系，确保数据的引用完整性和一致性。

#### 16域(Domain)

> 域标识属性的取值范围

#### 17数据类型(Data Type)

> 表中每个列都有相应的数据类型，它用于限制该列中存储的数据，每个字段表示同一类信息，具有相同的数据类型

#### 18关系模式(Relation Schema)

- 同数据模型一样，数据库也有"型"(type)和值(value)之分，在关系数据库中，关系模式是型，关系是值，即关系模式是对关系的描述

用大白话来说，“关系模式”就像是一张表格的设计图。在数据库的世界里，我们用表格来存储数据，而“关系模式”就是定义这张表格应该如何构建，包括表格里应该有哪些列（字段），每一列应该存储什么类型的数据，以及这些列之间有什么关系。

**关系模式**由以下几个部分组成：

1. **表名**：这是表格的名称，用来标识表格是关于什么的。比如，一个存储学生信息的表可能叫做“Students”。
2. **列（字段）**：表格中的每列代表一个特定的数据属性。比如，在“Students”表中，可能有一列叫做“Name”，用来存储学生的姓名；还有一列叫做“Age”，用来存储学生的年龄。
3. **数据类型**：每一列都有一个数据类型，这决定了该列可以存储什么类型的数据。比如，“Name”列可能是字符串类型，用来存储文本；“Age”列可能是整数类型，用来存储数字。
4. **键（Key）**：在关系模式中，键是用来唯一标识表中每条记录的。最常见的键是主键（Primary Key），它确保了每条记录的唯一性。
5. **约束（Constraints）**：这是一些规则，用来限制可以存储在表中的数据。比如，你可能有一个约束规定“Age”列只能存储0到120之间的整数。
6. **关系**：关系模式还定义了表与表之间的关系，比如通过外键（Foreign Key）来建立的参照关系。

举个例子，如果我们设计一个图书馆的数据库，我们可能会有一个“Books”表，这个表的关系模式可能包括：

- 表名：Books
- 列：BookID（主键，唯一标识每本书），Title（书名），Author（作者），PublishYear（出版年份）
- 数据类型：BookID（整数），Title（字符串），Author（字符串），PublishYear（整数）
- 约束：BookID必须是唯一的，PublishYear必须是有效的年份

通过定义关系模式，我们确保了数据库的结构清晰、组织有序，并且数据的存储和检索都是高效和准确的。

#### 19关系数据库(Relation Database)

> 关系数据库是以关系模型作为数据的逻辑模型，并采用关系作为数据组织方式的一类数据库，其数据库操作建立在关系代数的基础上。在给定的领域中，所有关系的集合构成一个关系数据库。

![image-20240603142622555](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603142622555.png?raw=true)

![image-20240603142825439](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603142825439.png?raw=true)

![image-20240603142855207](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603142855207.png?raw=true)

#### 二维表要求

- 每个属性都是不可分解的。
- 每个类系仅仅有一种关系模式，即每个关系模式中的属性的数据类型以及属性的个数和相对固定的
- 每个关系模式中的属性必须命名，在同一个关系模式中，属性名必须是不同的
- 同一个关系中不允许出现候选码或候选键值完全相同的元组。
- 在关系中元组的顺序(即行序)是无关紧要的，可以任意交换
- 在关系中属性的顺序(即列序)是无关紧要的，可以任意交换

### 关系操作集合

#### 1、基本的关系操作

**增删改查**：查询(Query)	操作和插入(Insct)	删除(Delete)	修改（Updata)操作等部分

![image-20240603145249193](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603145249193.png?raw=true)



#### 2、关系数据库语言分类

1. **关系代数**： 就像用数学公式来问数据库问题。比如，你可以说：“给我所有年龄大于20的学生的名字和分数。”关系代数就是用这种类似代数公式的方式来表达你的请求。
2. **元组关系演算**： 这种方式是用逻辑语言来描述你想要找到的数据。比如，你可以说：“找出所有在北京的学生。”这种方式关注的是数据记录（元组）本身。
3. **域关系演算**： 这也是一种逻辑方式，但它关注的是数据的属性（域），而不是记录。比如，你可以说：“找出所有分数超过90的记录。”

这三种方式虽然看起来不同，但其实它们都能做到相同的事情，就像用筷子、叉子或手抓食物，最终都能吃到东西。

这些操作语言是抽象的，意味着它们是理想化的，用来设计和评估实际的数据库查询语言。就像建筑师的设计图和实际建造的房子之间的关系。

实际的查询语言，比如SQL（结构化查询语言），是基于这些抽象概念建立的，但它还包括了很多额外的功能，比如计算平均分、更新数据等，让操作数据库变得更加方便和强大。

### 结构化语言

- 不仅具有丰富的查询功能，而且具有数据定义和数据控制功能，是集查询、`数据定义语言(DDL)`、`数据操纵语言(DML)`和`数据控制语言(DCL)`
- 因此关系数据库语言可以分为三类：关系代数语言、关系演算语言以及兼具两者双重特点的语言(SQL)

![image-20240603152748211](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603152748211.png?raw=true)

#### 传统的集合运算

- 具体有 `并、差、交、笛卡尔积`四种运算。

![image-20240603153610348](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603153610348.png?raw=true)

##### 1并（UNION）

![image-20240603153825149](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603153825149.png?raw=true)

##### 差(DIFFERENCE)

![image-20240603153925438](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603153925438.png?raw=true)

![image-20240603153944243](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603153944243.png?raw=true)

##### 交(INTERSECTION)

![image-20240603154220099](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603154220099.png?raw=true)

![image-20240603154245205](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603154245205.png?raw=true)

##### 笛卡尔积

![image-20240603154324574](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603154324574.png?raw=true)

![image-20240603154340536](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603154340536.png?raw=true)

![image-20240603154519363](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603154519363.png?raw=true)

#### 专间的关系运算

**一元专门关系操作**：

- **投影运算（Projection）**：就像是你把箱子里的一个或几个抽屉抽出来，只看这些抽屉里的东西，忽略其他的抽屉。在数据库里，这就像是说：“我只想看名字和年龄这两列的数据。”
- **选择运算（Selection）**：这就像是你决定只保留箱子里某些特定的东西，比如所有红色的或者所有大的东西。在数据库里，这就像是说：“我只想要那些年龄超过18岁的人的记录。”

**二元专门关系操作**：

- **连接运算（Join）**：假设你有另一个类似的箱子，里面也有抽屉和层，但是装的是不同的信息。连接运算就像是把两个箱子里相对应的东西拿出来放在一起看。比如，一个箱子里有学生的成绩，另一个箱子里有学生的个人信息，连接运算就是把每个学生的成绩和他们的个人信息放在一起。
- **除运算（Division）**：这个稍微复杂一点，就像是你有一堆东西，你想知道哪些东西是共有的。在数据库里，这就像是说：“给我找出那些至少选了两门课的所有学生的名字。”

##### 1、选择SELECT

![image-20240603155352039](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603155352039.png?raw=true)

![image-20240603155419311](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603155419311.png?raw=true)

##### 2、投影(PROJECTION)

![image-20240603160213509](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603160213509.png?raw=true)

![image-20240603160237058](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603160237058.png?raw=true)

![image-20240603160244791](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603160244791.png?raw=true)

##### 3、连接(JOIN)

![image-20240603161205569](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603161205569.png?raw=true)

##### 4、除（DIVISION）

![image-20240603162700837](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240603162700837.png?raw=true)

### 关系完整性约束

数据库的数据完整性就像是保证数据库里的信息是准确、合理且没有矛盾的。这就像是你有一个关于学生的记录本，里面记录了学生的学号、性别和他们上的课。

- **正确性**：意味着每条信息都是对的，比如学生的学号没有重复，性别只能是男或女。
- **相容性**：意味着信息之间是协调的，比如一个学生选的课必须是学校真的开的课。
- **一致性**：意味着不管什么时候看，信息都是一样的，没有矛盾。

数据库里的完整性规则就像是一些规则和检查，确保当你往记录本里添加、删除或修改信息时，本子上的信息还是准确和合理的。这样，当你查看记录本时，得到的信息都是有意义的，能够真实反映每个学生的情况。所以，保持数据的完整性对于数据库来说非常重要。

> **实体完整性和参照完整性是关系模型必须满足的完整性约束条件，被称作是关系的两个不变性。**

#### 实体完整性约束

就是数据库里的一条规矩，它确保每条记录都是独一无二的，并且记录里的重要信息不能是空的。

比如，你有一个学生信息表，每个学生都有一个独一无二的学号。实体完整性约束就会确保：

1. 学号这一列不能有空值，因为学号是识别每个学生的依据。
2. 学号必须是唯一的，不能有两个学生有相同的学号。

这个约束就像是在说：“嘿，注意了，每个学生都得有一个自己的学号，而且这个学号不能跟其他人重复，这样我们才能清楚地知道谁是谁。”通过这样的规则，数据库就能保持数据的准确性和一致性。

#### 参照完整性约束

Referential Integrity Constraint

参照完整性约束，就是数据库里的一种规则，它保证了一个表中的某个字段（通常是外键）必须在另一个表的某个字段（主键）中也有相同的值。简单来说，就是：

1. **不能有孤儿**：如果一个表里的记录指向了另一个表中的某个记录，那么这个被指向的记录不能被删除，否则第一个表里的记录就会成为“孤儿”。
2. **更新要同步**：如果一个表中的主键值被更新了，那么所有指向这个主键的外键值也必须更新，以保持一致性。

就像你不能在家庭相册中删除一张家庭成员的照片，而不更新所有相关联的宠物照片一样。

#### 用户自定义完整性约束

用户自定义完整性约束，就像是给数据库定的额外家规。除了数据库自带的一些基本规则，比如学号唯一、性别只能是男或女之外，有时候我们还需要一些特别的规则来确保数据的准确性。

比如，你可能想要一个规则来确保：

- 学生的入学年份不能晚于当前年份。
- 订单的总价不能是负数。
- 员工的工号必须符合某种特定的格式，比如以特定的字母开头。

这些规则不是数据库天生就有的，而是根据你的具体需求来设定的。用户自定义完整性约束就是让你能够添加这些特别的规则，来保证数据库里的数据不仅满足基本要求，还满足你的业务逻辑和需求。

### 关系数据库规范

#### 数据冗余

- 数据冗余通常指同一个数据被多长进行了存储，例如，卖出了1000种相同的货物，并且被反复存储了1000次

#### 更新异常

- 数据冗余将导致空间的浪费和潜在的数据不一致及修改麻烦等问题。更改了999个数据有一个没有更新，那么数据就可能出现不一致。

#### 插入异常

就是当你想往数据库里添加新数据时，因为某些数据不符合规则，导致你不能添加。比如，你想添加一个学生的信息，但是忘了写学号，或者学号已经被别人用了，数据库就会说：“不行，你得按规矩来。” 

#### 删除异常

就是当你想从数据库里删除某些数据时，因为这些数据和其他重要数据有关联，删除它们会导致问题。比如，你想删除一个课程，但是有学生已经选了这门课，数据库就会说：“不行，这门课还有学生在上，你不能删。”

### 函数依赖

#### 完全函数依赖

就像你有一个密码锁，需要一个完整的密码才能打开。在数据库里，完全函数依赖意味着一个字段（或字段组合）完全依赖于另一个字段组合（通常是主键），没有任何一部分可以单独存在。如果去掉主键的一部分，你就无法确定这个字段的值了。

#### 部分函数依赖

这就像是你有一个密码锁，但是只需要密码的一部分就能打开。在数据库里，部分函数依赖是指一个字段依赖于主键的一部分，而不是整个主键。这意味着即使只有主键的一部分，也能确定这个字段的值，这通常不是我们想要的，因为它违反了规范化的原则，可能会导致数据冗余和更新异常。

#### 传递函数依赖

想象一下，你有一个传声筒，你在这头说话，声音通过中间的管道传到另一头。在数据库里，传递函数依赖就像是A字段决定了B字段，然后B字段又决定了C字段。虽然C字段实际上并不直接依赖于A字段，但是因为B的存在，C间接地依赖了A。

简单来说，就是如果通过一个字段（A）可以确定另一个字段（B），然后B又可以确定第三个字段（C），那么C就间接地依赖于A，这就是传递函数依赖。这种情况可能会让数据库设计变得复杂，因为它意味着字段之间有间接的联系，这在设计数据库时需要特别注意。

### 关系规范化过程

在关系数据库中，不同程度的要求称为不同的范式(NF)。满足最低要求的范式为第一范式(INF最基本范式),在第一范式的基础上进一步满足称为第二范式(2NF),以此类推，再进一步的范式是第三范式(3NF)以及其改进模型(BCNF)

![image-20240604144713351](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240604144713351.png?raw=true)

#### 第一范式1NF

**属性不可再分的原子值**

- 第一范式是一个不含重复组的关系，其中不存在嵌套结构。不满足第一范式的关系为非规范关系。例如：2.16图片中SC关系是一个非规范关系，因为学号为80154的学生数据库中出现了重复组。
- 非规范关系转化为1NF较为容易，可以通过重写关系中属性值相同部分数据来实现。如2.17所示的1NF

>**特点**：数据表中的每个字段都不能再分解成更小的单位。想象一下，你的学生信息表中有一列是“联系方式”，里面记录了学生的电话号码和电子邮件地址。这不符合1NF，因为“联系方式”这个字段还可以继续分解为“电话号码”和“电子邮件”两个字段。

![image-20240604151201267](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240604151201267.png?raw=true)



#### 第二范式 2NF

- 由2.17分解成的表2.18和2.19所示的关系都是1NF的，不存在非主属性对候选关键字的部分函数依赖，因此也满足2NF的定义。
- 然而2NF不能解决所有问题。在关系CI中，仍然存在插入、删除操作异常及修改麻烦等问题。例如有一位新老师报到，插入到CI中，但是该教师暂时还未承担任何教学工作，因此CNO值不能进行插入操作。

>满足1NF的基础上，要求表中没有字段是部分依赖于候选键的。候选键是可以用来唯一标识一条记录的字段或字段组合。如果一个表中，学生的“课程成绩”只依赖于“课程编号”而不是整个候选键“学生编号+课程编号”，那么这就违反了2NF。为了满足2NF，你需要把“课程编号”和“学生编号”分开，各自独立存储。
>
>如果一个表有组合主键，那么表中的其他字段必须依赖于这个组合主键的全部，而不是只依赖于其中的一部分。这样可以避免数据冗余和更新异常。

![image-20240604152444318](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240604152444318.png?raw=true)

#### 第三范式 3NF

- 根据第三范式，由分解形成的表2.20和2.21分别所示的关系COURSE和关系INSTRUCTOR都是第三范式。

- 通常，第三范式的关系大多数都能解决插入和删除操作异常的问题，数据冗余也能得到有效控制。但是，也存在一些列外。如表2.22所示的SCT中，若每个学生选多门课程，每一门课程可有多个指导老师，但每个老师只能指导一门。

>**特点**：满足2NF的基础上，要求表中没有字段是传递依赖于候选键的。传递依赖意味着一个字段依赖于另一个非主键字段。比如，如果“学生姓名”依赖于“学生编号”，而“学生编号”又是主键，那么“学生姓名”就是传递依赖于主键的，这违反了3NF。为了满足3NF，你需要将“学生姓名”和“学生编号”分开存储，消除这种传递依赖。
>
>3NF要求你确保数据表中的非主键字段之间没有相互依赖的关系，它们要么独立，要么直接依赖于主键。这有助于进一步规范数据表的结构，减少数据冗余，提高数据的一致性和完整性。

![image-20240604153835802](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240604153835802.png?raw=true)

#### 第三半范式 BCNF

- BCNF就像是3NF的加强版。它要求在数据表里，如果一个字段（X）依赖于另一个字段（Y），那么Y必须是构成主键的一部分。简单来说，就是不允许有任何字段依赖于主键之外的任何字段组合。

>- BCNF要求你确保数据表中的所有字段依赖都是直接与主键相关联的，不允许有任何间接的依赖关系。这有助于进一步规范数据表的结构，确保数据的规范化，减少数据冗余，提高数据的一致性和完整性。

![image-20240604164341074](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240604164341074.png?raw=true)

经分析，引起上述问题的原因在于：主属性之间存在函数依赖TNAME—>TITLE故需要进一步规范化，其结果为表2.23和2.24分别所示的ST和关系TC

![image-20240604164442934](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240604164442934.png?raw=true)

# 第四章 数据库设计概述















































































































































































































































# Postgresql

### 什么是数据库

数据库（Database，DB）是一个长期存储在计算机内的、有组织的、有共享的统一管理的数据集合

- 保管数据的“创库”
- 数据管理的方法和技术

### 数据表的概念

- 数据库表：是一系列`二维数组的集合`
- 横向的行(记录、行)
- 纵向（字段、属性、列）

![image-20240529230301119](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240529230301119.png?raw=true)

### 数据类型的概念

- 常用数据类型：
  - 整数数据类型
  - 浮点数据类型
  - 日期/时间数据类型
  - 字符串数据类型
  - 二进制数据类型

![image-20240529230244329](https://github.com/liuzhenhua1223/Image/blob/master//PGSQL/image-20240529230244329.png?raw=true)

### 数据库系统的构成

- 数据库（以数据为载体进行保存的软件）
- 数据库管理系统（面向数据库管理人员）
- 数据库应用程序 (面向普通用户)

![image-20240529230301119.png](https://github.com/liuzhenhua1223/Image/blob/master/PGSQL/image-20240529230301119.png?raw=true)

### SQL语言

SQL是对数据库进行查询和修改操作语言。

SQL语言包含4个部分：

- DDL 数据库定义语言：DROP CREATE ALTER
- DML 数据库操作语言： INSET UPDATA DELETE
- DQL 数据库查询语言： SELEDT
- SCL 数据库控制余元： GRANT REVOKE COMMIT ROLLBACK

### 常用的数据库访问技术

- ODBC (Open Database Connectivity)开放数据库连接
- JDBC (Java Database Connctivity) Java数据库连接

- PDO：PHP语言访问技术

## 

